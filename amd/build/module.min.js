define(["jquery","core/ajax","core/notification"],function(e,o,d){return{init:function(e){var n=document.getElementById("paddle-checkout");if(n){try{"undefined"!=typeof Paddle&&void 0!==Paddle.Environment&&"sandbox"===e.environment&&Paddle.Environment.set("sandbox")}catch(e){console.error("Paddle setup error:",e)}n.addEventListener("click",function(){n.dataset.loading||(n.dataset.loading="1",n.setAttribute("disabled","disabled"),console.log("Paddle Checkout: Calling AJAX with args:",e),console.log("Paddle Checkout: instanceid =",e.instanceid,"(type:",typeof e.instanceid,")"),o.call([{methodname:"enrol_paddle_get_checkout_id",args:{instanceid:parseInt(e.instanceid,10)}}])[0].then(function(e){if(e&&e.debug&&e.debug.console_log&&(console.group("=== PADDLE EXECUTION LOG ==="),console.log(e.debug.console_log),console.groupEnd()),e&&e.debug){if(console.group("Paddle Checkout Debug"),e.debug.endpoint&&console.log("Endpoint:",e.debug.endpoint),e.debug.response_code&&console.log("HTTP Code:",e.debug.response_code),e.debug.payload)try{console.log("Request Payload:",JSON.parse(e.debug.payload))}catch(o){console.log("Request Payload:",e.debug.payload)}e.debug.response_body&&console.log("Response Body:",e.debug.response_body),console.groupEnd()}if(!e||!e.success||!e.checkout_id)throw new Error(e&&e.error?e.error:"Invalid response from Moodle");if("undefined"==typeof Paddle||void 0===Paddle.Checkout)throw new Error("Paddle.js not loaded or initialized correctly.");Paddle.Checkout.open({checkoutId:e.checkout_id}),delete n.dataset.loading,n.removeAttribute("disabled")}).catch(function(o){console.error("Paddle checkout error:",o),console.error("Full error object:",JSON.stringify(o,null,2)),console.error("Error keys:",Object.keys(o)),o.exception&&console.error("Exception:",o.exception),o.errorcode&&console.error("Error code:",o.errorcode),o.debuginfo&&console.error("Debug info:",o.debuginfo),o.backtrace&&console.error("Backtrace:",o.backtrace);var r=e.checkoutcreationfailed;o.message&&(r=o.message),d.exception({message:r,err:o}),delete n.dataset.loading,n.removeAttribute("disabled")}))})}}}});