define(["jquery","core/ajax","core/notification"],function(e,o,d){return{init:function(e){var n=document.getElementById("paddle-checkout");if(n){try{"undefined"!=typeof Paddle&&void 0!==Paddle.Environment&&"sandbox"===e.environment&&Paddle.Environment.set("sandbox")}catch(e){console.error("Paddle setup error:",e)}n.addEventListener("click",function(){n.dataset.loading||(n.dataset.loading="1",n.setAttribute("disabled","disabled"),console.log("Paddle Checkout: Calling AJAX with args:",e),console.log("Paddle Checkout: instanceid =",e.instanceid,"(type:",typeof e.instanceid,")"),o.call([{methodname:"enrol_paddle_get_checkout_id",args:{instanceid:parseInt(e.instanceid,10)}}])[0].then(function(e){if(e&&e.debug){console.group("Paddle Checkout Debug"),console.log("Endpoint:",e.debug.endpoint),console.log("HTTP Code:",e.debug.response_code),console.log("Request Payload:",JSON.parse(e.debug.payload)),console.log("Response Body:",e.debug.response_body);try{console.log("Response JSON:",JSON.parse(e.debug.response_body))}catch(e){}console.groupEnd()}if(!e||!e.success||!e.checkout_id)throw new Error(e&&e.error?e.error:"Invalid response from Moodle");if("undefined"==typeof Paddle||void 0===Paddle.Checkout)throw new Error("Paddle.js not loaded or initialized correctly.");Paddle.Checkout.open({checkoutId:e.checkout_id}),delete n.dataset.loading,n.removeAttribute("disabled")}).catch(function(o){console.error("Paddle checkout error:",o);var t=e.checkoutcreationfailed;o.message&&(t=o.message),d.exception({message:t,err:o}),delete n.dataset.loading,n.removeAttribute("disabled")}))})}}}});